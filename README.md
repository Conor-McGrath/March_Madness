# Predicting the Madness

[NCAA](plot/kyleguy.jpg)

Every year Kaggle holds a [March Machine Learning Mania](https://www.kaggle.com/c/ncaam-march-mania-2021) competition where users build models to predict win probabilities for each hypothetical matchup in the NCAA basketball tournament. The model that Michael Mayer and I have submitted uses historical Vegas Spreads scraped from [DonBest](https://legacy.donbest.com/ncaab/scores/), advanced metrics scraped from [KenPom](https://kenpom.com/), and seeding. The approach we have taken is similar to that of 2014's winners, Gregory Matthews and Michael Lopez who have published a paper explaining their [model](https://arxiv.org/abs/1412.0248).

# The Code
In this repository you will see the following numbered R Scripts:
  - **Seed_Win_Probabilities.R**: Gives historical conditional and unconditional probabilities based solely off the seed of the team. Interestingly, 12 seeds have a 15% chance of making it to the Sweet 16, whereas 9 seeds only have a 5% chance, even though 9 seeds are much more likely to win their first round game.
  - **1_KenPom_Scrape.R**: Scrapes advanced statistics, such as Adjusted Efficiency Margin, Adjusted Offensive Efficiency, Adjusted Defensive Efficiency, etc., for each Division 1 team going back to the 2001-2002 season to be used as predictor variables.
  - **2_Odds_Scrape.R**: Scrapes the Vegas spreads for every Divsion 1 basketball game going back to the 2007-2008 season to be used as predictor varaibles in the model. 
  - **3_Get_Past_Spreads.R**: Combines the KenPom statistics with the spreads to get a row for each game played since the 2007-2008 season.
  - **4_Spread_Model.R**: An XGBoost model is needed in order to predict spreads for hypothetical matchups in the 2021 tournament other than the first round matchups. Since submissions are due before the start of the first round, the only actual spreads at our disposal at the time was the first round spreads. For all other hypothetical matchups in all other rounds, these spreads had to be predicted so that they could be used as predictor variables in the final model predicting win probability.
  - **5_Make_Predictions_For_Spreads.R**: Run model on hypothetical matchups to get the predicted spreads and then combine with actual spreads to get all of the predictor variables needed for the final model. For first round matchups, the actual spread is used. All others use the predicted spread from the model.
  - **6_Tidy_Data_Ready_For_Model.R**: Clean data so it can be ready for use in the final XGBoost model. Here is where we filter for only tournament games since the 2007-2008 season.
  - **7_Train_Model.R**: Train the XGBoost model on the tournament games since 2007-2008. The final model shap plot shows that the Adjusted Efficiency Margin metric from KenPom is the most predictive variable in determining a team's win probability in the tournament, even far more important than the Spread.
  - **8_Make_Predictions.R**: Run the model on the 2021 tournament data to generate the preds_to_send.csv file for submission in the Kaggle competition. 
  - **9_Bracket_Visualization.R**: Uses the collegehoops package developed by dhutexas (an earlier version was developed by zachmayer) to visualize what the bracket would look like using this model. The bracket is generated using a straight walk through method where teams with a greater than 50% probability of winning that particular game are selected to move on to the next round.
  
  # The Bracket
  
Here is the bracket produced from the model with the corresponding conditional probability of each team getting to that position. For example, the probability of Gonzaga beating Baylor in the national championship is 59% which is why there is a .59 next to Gonzaga in the center of the bracket.
  
  [Bracket Image](plot/Bracket.png)
  
Here is a visualization of the Final Four, National Championship, and National Champion generated by the model. This visualiation was created in Shiny. Any user can upload their Kaggle csv submission to the [Shiny app](https://github.com/Conor-McGrath/KaggleMarchManiaBracket) and it will generate a similar visualization with the Final Four teams, National Championship, and National Champion determined by your model.

[Final Four Bracket](plot/finalfour.png)

# The Results

As of 4/2 the model currently sits at 313/707 on the Kaggle leaderboard and is in the 56th percentile. The model accurately predicted three of the final four teams (Houston, Baylor, and Gonzaga) and narrowly missed out on Michigan who lost by two in the Elite Eight. Now we wait and see whether the model was right in picking Baylor over Houston in the final four and whether Gonzaga can pull off the perfect season and win the national championship.
